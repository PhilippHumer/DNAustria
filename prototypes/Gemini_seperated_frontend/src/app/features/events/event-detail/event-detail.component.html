<div class="p-6 max-w-4xl mx-auto bg-white rounded-lg shadow-md mt-6" *ngIf="currentEvent">
  <div class="flex justify-between items-start mb-6 border-b pb-4">
    <div>
        <h2 class="text-3xl font-bold text-gray-800">{{currentEvent.title}}</h2>
        <div class="mt-2 flex gap-2">
            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700 uppercase tracking-widest border">
                {{getStatusLabel(currentEvent.status)}}
            </span>
            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-blue-50 text-blue-700 border border-blue-100">
                {{getClassificationLabel(currentEvent.classification)}}
            </span>
        </div>
        <div class="mt-2 text-sm text-gray-500" *ngIf="organization">
            Organized by: <span class="font-semibold text-gray-700">{{organization.name}}</span>
        </div>
    </div>
    
    <div class="flex gap-2">
        <button mat-stroked-button [matMenuTriggerFor]="statusMenu" [disabled]="eventForm.disabled">
            Change Status <mat-icon>arrow_drop_down</mat-icon>
        </button>
        <mat-menu #statusMenu="matMenu">
            @for (status of eventStatuses; track status) {
                <button mat-menu-item (click)="updateStatus(status)">{{getStatusLabel(status)}}</button>
            }
        </mat-menu>
        
        <button mat-icon-button color="warn" (click)="onDelete()" title="Delete Event">
            <mat-icon>delete</mat-icon>
        </button>
    </div>
  </div>

  <form [formGroup]="eventForm" (ngSubmit)="onUpdate()" class="flex flex-col gap-4">
    <!-- Similar fields to Create -->
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Title</mat-label>
      <input matInput formControlName="title">
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="description" rows="5"></textarea>
    </mat-form-field>
    
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Event Link</mat-label>
      <input matInput formControlName="eventLink">
    </mat-form-field>
    
    <div class="flex flex-col md:flex-row gap-4">
        <mat-form-field appearance="outline" class="flex-1">
          <mat-label>Start Date</mat-label>
          <input matInput [matDatepicker]="pickerStart" formControlName="dateStart">
          <mat-datepicker-toggle matIconSuffix [for]="pickerStart"></mat-datepicker-toggle>
          <mat-datepicker #pickerStart></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="flex-1">
          <mat-label>End Date</mat-label>
          <input matInput [matDatepicker]="pickerEnd" formControlName="dateEnd">
          <mat-datepicker-toggle matIconSuffix [for]="pickerEnd"></mat-datepicker-toggle>
          <mat-datepicker #pickerEnd></mat-datepicker>
        </mat-form-field>
    </div>

    <div class="flex flex-wrap gap-4 items-center">
        <mat-checkbox formControlName="isOnline">Online Event</mat-checkbox>
        <mat-checkbox formControlName="fees">Requires Fees</mat-checkbox>
        <mat-checkbox formControlName="schoolBookable">School Bookable</mat-checkbox>
    </div>

    <!-- Additional fields -->
    <div class="flex flex-col md:flex-row gap-4">
        <mat-form-field appearance="outline" class="flex-1">
            <mat-label>Program Name</mat-label>
            <input matInput formControlName="programName">
        </mat-form-field>
        <mat-form-field appearance="outline" class="flex-1">
            <mat-label>Format</mat-label>
            <input matInput formControlName="format">
        </mat-form-field>
    </div>

    <div class="flex flex-col md:flex-row gap-4">
        <mat-form-field appearance="outline" class="flex-1">
            <mat-label>Age Minimum</mat-label>
            <input matInput type="number" formControlName="ageMinimum">
        </mat-form-field>
        <mat-form-field appearance="outline" class="flex-1">
            <mat-label>Age Maximum</mat-label>
            <input matInput type="number" formControlName="ageMaximum">
        </mat-form-field>
    </div>
    
    <!-- Location Details -->
    <div formGroupName="location" class="flex flex-col gap-4 p-4 border rounded bg-gray-50">
        <h3 class="font-semibold text-gray-700">Location</h3>
        
        <mat-form-field appearance="outline" class="w-full">
        <mat-label>Location Name</mat-label>
        <input matInput formControlName="name">
        </mat-form-field>

        <div class="flex flex-col md:flex-row gap-4">
        <mat-form-field appearance="outline" class="flex-1">
            <mat-label>Street</mat-label>
            <input matInput formControlName="street">
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="w-32">
            <mat-label>ZIP</mat-label>
            <input matInput formControlName="zip">
        </mat-form-field>
        </div>

        <div class="flex flex-col md:flex-row gap-4">
        <mat-form-field appearance="outline" class="flex-1">
            <mat-label>City</mat-label>
            <input matInput formControlName="city">
        </mat-form-field>

        <mat-form-field appearance="outline" class="flex-1">
            <mat-label>State</mat-label>
            <input matInput formControlName="state">
        </mat-form-field>
        </div>
    </div>

    <!-- Contact Details -->
    <div formGroupName="contact" class="flex flex-col gap-4 p-4 border rounded bg-gray-50">
        <h3 class="font-semibold text-gray-700">Contact</h3>
        
        <mat-form-field appearance="outline" class="w-full">
            <mat-label>Contact Name</mat-label>
            <input matInput formControlName="name">
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
            <mat-label>Organization (Contact)</mat-label>
            <input matInput formControlName="org">
        </mat-form-field>

        <div class="flex flex-col md:flex-row gap-4">
            <mat-form-field appearance="outline" class="flex-1">
                <mat-label>Email</mat-label>
                <input matInput formControlName="email">
            </mat-form-field>
            <mat-form-field appearance="outline" class="flex-1">
                <mat-label>Phone</mat-label>
                <input matInput formControlName="phone">
            </mat-form-field>
        </div>
    </div>

    <div class="flex flex-col md:flex-row gap-4">
       <!-- Replicating selects for complexity completeness -->
        <mat-form-field appearance="outline" class="flex-1">
          <mat-label>Target Audience</mat-label>
          <mat-select formControlName="targetAudience" multiple>
            @for (audience of targetAudiences; track audience) {
              <mat-option [value]="audience">{{getTargetAudienceLabel(audience)}}</mat-option>
            }
          </mat-select>
        </mat-form-field>

         <mat-form-field appearance="outline" class="flex-1">
          <mat-label>Topics</mat-label>
          <mat-select formControlName="topics" multiple>
            @for (topic of eventTopics; track topic) {
              <mat-option [value]="topic">{{getTopicLabel(topic)}}</mat-option>
            }
          </mat-select>
        </mat-form-field>
    </div>
    
    <mat-checkbox formControlName="isOnline">Online Event</mat-checkbox>

    <div class="flex justify-end gap-4 mt-6 pt-4 border-t">
      <button mat-button type="button" routerLink="/events">Back to List</button>
      <button mat-flat-button color="primary" type="submit" [disabled]="eventForm.invalid || eventForm.disabled">
        Update Event
      </button>
    </div>
  </form>
</div>
